[steps of installation](https://www.bilibili.com/video/BV1HG411L79z/?buvid=XY1F3EB1D84CA2893FCFAD87BAC348BE117E8&from_spmid=search.search-result.0.0&is_story_h5=false&mid=rofn9VFsUILPoPJ8HFnerg%3D%3D&p=1&plat_id=116&share_from=ugc&share_medium=android&share_plat=android&share_session_id=69e55613-7d35-4797-a9c7-6be8044a478a&share_source=COPY&share_tag=s_i&spmid=united.player-video-detail.0.0&timestamp=1697248509&unique_k=8uvQH50&up_id=481361060&vd_source=f66e0891a6ac513c7709150a803a70e1) ï¼š
1. [x] Nodeã€[yarn](https://classic.yarnpkg.com/lang/en/docs/install/#windows-stable)(`npm i -g yarn`)ã€IDEã€git
2. [x] [Rails on Ruby](https://railsinstaller.dev/)(containing Rails, Ruby & working SQLite), check version `ruby -v`, `rails -v`
3. [x] [Ruby](https://rubyinstaller.org/downloads/)ï¼ˆâˆšMSYS2; choose 3-install all. manually update Ruby versionï¼‰, check version`ruby -v`
4. [x] `gem install rails`(automatically update Rails version), check version`rails -v`
5. [x] `rails new xx-project-name`, `rails s(server)`, open localhost:3000![[Pasted image 20231014114555.png|300]]
	- [ ] or add bundler Shakapacker (a fully featured bundler, with hot module replacement and transformation of ES6+ syntax via Babel) before new rails:
		- `rails new xxx-project-directory --skip-javascript`ï¼ˆ_installs the older v5 version of webpacker unless you specifyÂ `--skip-javascript`_; ~~no need to install Importmap in Rails v7ï¼‰~~, `cd xxx-project-directory`
		- â†’search for "start command prompt with ruby" in the start menu and right click on it. Select "More" then "Run as administrator" (This will open an elevated command prompt with Ruby loaded). Navigate to your project directory(`cd xxx\xxx\xxx-project-directory`) and run: `bundle add shakapacker --strict` ==(cmd have no permission from administrator in windows 10)==![[Pasted image 20231017124352.png|500]]
		- â†’go back to VSCode, `./bin/bundle install`+ `./bin/rails shakapacker:install`==(shakapacker v7 changed from `rails webpacker:install` in v6)==+ `yarn add react react-dom @babel/preset-react`+ UpdateÂ 'package.json'Â to add theÂ `@babel/preset-react`(see JSON code3 bellow)![[Pasted image 20231016210702.png|500]]
		- â†’`rails s(server)`, localhost:3000
```ruby
#code1
# Pin npm packages by running ./bin/importmap
Rails.application.config.importmap.draw do
  pin "@hotwired/turbo-rails", to: "turbo.min.js", preload: true
  pin "@hotwired/stimulus", to: "stimulus.min.js", preload: true
  pin "@hotwired/stimulus-loading", to: "stimulus-loading.js", preload: true
  pin_all_from "app/javascript/controllers", under: "controllers"

  pin "htm", to: "htm.min.js" 
  pin "react", to: "react.min.js" 
  pin "react-dom", to: "react-dom.min.js"
  pin_all_from "app/javascript/components", under: "components"

  pin "application", preload: true
end
```

```ruby
#code2
# Enable server-side Importmap uploads
config.importmap.enabled = true
```

```json
//code3
"babel": {
  "presets": [
    "./node_modules/shakapacker/package/babel/preset.js",
    "@babel/preset-react"
  ]
},
```

6. [ ] Enable HMR for Shakapacker (or can't use `./bin/shakapacker-dev-server` in step7)
	- hop intoÂ 'config/shakapacker.yml',Â setÂ `hmr`Â toÂ `true`
		- ==(shakapacker v7 changed from 'config/webpacker.yml' in v6)==![[Pasted image 20231016210901.png|500]]
	- â†’alterÂ `config/webpack/webpack.config.js`Â like so (see Javascript code4 bellow) 
		- ==(shakapacker v7 switch to `const { generateWebpackConfig } = require('shakapacker')`+`const webpackConfig = generateWebpackConfig()`, from `const { webpackConfig } = require('shakapacker')` in v6)==![[Pasted image 20231016211023.png|500]]
	- â†’install 2 packages: `yarn add --dev react-refresh @pmmmwh/react-refresh-webpack-plugin`
	- â†’delete the Babel configuration fromÂ `package.json`(see JSON code3 before), `touch babel.config.js`Â in the root of project and add the following (see Javascript code5 bellow) 
	- â†’restart the server, refresh the browser
```javascript
//code4
//const { webpackConfig, inliningCss } = require('shakapacker');

const { generateWebpackConfig, inliningCss } = require('shakapacker')
const webpackConfig = generateWebpackConfig()

const ReactRefreshWebpackPlugin = require('@pmmmwh/react-refresh-webpack-plugin')
const isDevelopment = process.env.NODE_ENV !== 'production'

if (isDevelopment && inliningCss) {
  webpackConfig.plugins.push(
    new ReactRefreshWebpackPlugin({
      overlay: {
        sockPort: webpackConfig.devServer.port,
      },
    })
  )
}

module.exports = webpackConfig
```

```javascript
//code5
module.exports = function (api) {
  const defaultConfigFunc = require('shakapacker/package/babel/preset.js')
  const resultConfig = defaultConfigFunc(api)
  const isDevelopmentEnv = api.env('development')
  const isProductionEnv = api.env('production')
  const isTestEnv = api.env('test')

  const changesOnDefault = {
    presets: [
      [
        '@babel/preset-react',
        {
          development: isDevelopmentEnv || isTestEnv,
          useBuiltIns: true
        }
      ]
    ].filter(Boolean),
    plugins: [
      isProductionEnv && ['babel-plugin-transform-react-remove-prop-types',
        {
          removeImport: true
        }
      ],
      process.env.WEBPACK_SERVE && 'react-refresh/babel'
    ].filter(Boolean),
  }

  resultConfig.presets = [...resultConfig.presets, ...changesOnDefault.presets]
  resultConfig.plugins = [...resultConfig.plugins, ...changesOnDefault.plugins ]

  return resultConfig
}
```
7. [ ] Create a Hello World React App
	- â†’Generate aÂ `site`Â controller with anÂ `index`Â action: `rails g controller site index`
	- â†’Replace the contents of app/views/site/index.html.erb: `echo '<div id="root"></div>' > app/views/site/index.html.erb`
	- â†’Create an App component for our React application inside of a components folder in the 'app/javascript' directory: `mkdir app/javascript/components`+ `touch app/javascript/components/App.js`, Add the following code to 'app/javascript/components/App.js' (see Javascript code6 bellow) 
	- â†’`touch app/javascript/application.js`, add the following code to 'app/javascript/application.js' (see Javascript code7 bellow) , to import a HelloMessage component and renders it in the div element we created above
	- â†’Add a root route to the config/routes.rb file: `root to: 'site#index'`, and delete `get 'site/index'`
	- â†’If using Shakapacker, `rails s` (kick off the Rails server in one terminal)+ `./bin/shakapacker-dev-server` (the webpack dev server in another. ==shakapacker v7 changed from `./bin/webpacker-dev-server` in v6==)![[Pasted image 20231016224754.png|500]]
```javascript
//code6
import React from 'react';
const HelloMessage = ({ name }) => <h1>Hello, {name}!</h1>;
export default HelloMessage;
```

```javascript
//code7
import React from 'react';
import { createRoot } from 'react-dom/client';
import HelloMessage from './components/App';

const container = document.getElementById('root');
const root = createRoot(container);

document.addEventListener('DOMContentLoaded', () => {
  root.render(<HelloMessage name="World" />);
});
```



---
problems:
7. 
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— (see Ruby code1 before) 
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— forget `Rails.application.config.importmap.draw do`&`end` when setting up via the configuration inÂ `config/importmap.rb`
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— `.bin/importmap pin react react-dom` command not working; and `rails s` meet error:
```javascript
undefined method `pin' for 
main:Object 
(NoMethodError)

pin "react", to: "http://localhost:3035/react.js"
^^^
Did you mean?  print 
```

6. ==unsolved==
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— ~~`./bin/bundle add importmap-rails`+ `./bin/rails importmap:install`+add mappings to 'importmap.rb' (see Ruby code1 before) + enable support in 'config/environments/development.rb' (see Ruby code2 before) +`touch app/javascript/application.js`+ add `import 'components'` to it~~
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— ~~Importmap for Rails is automatically included in Rails 7+ for new applications, but you can also install it manually in existing applications~~
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— =='HelloWorld' wrote with react not appearing

5. 
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— use 'http://localhost:3000' instead, and don't forget to comment `get 'site/index'` to avoid a conflict of route path
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— now 'http://localhost:3000' (root) stands for page 'http://localhost:3000/site/index'
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— after add a root route to the config/routes.rb file: `root to: 'site#index'`, can't use 'http://localhost:3000/site/index' to reach the webpage

4. ==unsolved==
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— 
~~- follow doc of shakapacker installation, add `yarn add @babel/core @babel/plugin-transform-runtime @babel/runtime babel-loader \  compression-webpack-plugin terser-webpack-plugin \  webpack webpack-assets-manifest webpack-cli webpack-merge webpack-sources webpack-dev-server`(ğ™šğ™§ğ™§ğ™¤ğ™§: still 'command not found')~~
~~- â†’ask claude.ai, add`npm uninstall webpack webpack-cli -g`+`npm install webpack webpack-cli --save-dev`+`npx webpack --config webpack.config.js`(ğ™šğ™§ğ™§ğ™¤ğ™§: Failed to 
load 'C:\Users\hellowlee\Desktop\js\event-manager2\webpack.config.js' config)~~
~~- â†’ask claude.ai, add `npx webpack init`(ğ™šğ™§ğ™§ğ™¤ğ™§: still 'command not found'; but there is a `yarn serve` script in 'package.json' standing for `webpack serve`, which is a simpler and more automated command than `webpack-dev-server`)~~
~~- â†’use `yarn serve` command instead (ğ™šğ™§ğ™§ğ™¤ğ™§: Multiple configuration files 
found. Please remove one:  - package.json - C:\Users\hellowlee\Desktop\js\event-manager2\.babelrc )~~
~~- â†’remove file '.babelrc' (ğ™šğ™§ğ™§ğ™¤ğ™§: lead to a page 'http://localhost:8080/' and content 'Hello world! Tip: Check your console')~~
~~- â†’webpack config~~
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— ~~forget to install ~~
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— ==after `./bin/shakapacker-dev-serve` in git bash:  
```javascript
.bin/shakapacker-dev-server: command not found
```

3. 
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— 
1.you can safely **ignore those warnings** 'has unmet peer dependency'. (or You can also check outÂ `react-avatar-editor@14.0.0-beta.0`Â where we completely replaced the build architecture.)
2.you can safely **ignore those warnings** '..\package.json: No license'. (or You change directory `yarn install` from the 'xxx-project-directory' to 'xxx-project-directory/bin')
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— 
1.`devDependencies`Â related.
2.It's referring to a 'package.json' one directory level higher.
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— after `./bin/rails shakapacker:install` in git bash:      
```javascript
yarn add v1.22.19
warning ..\package.json: No license 
field
[1/4] Resolving packages...
[2/4] Fetching packages...
[3/4] Linking dependencies...       
warning " > shakapacker@7.1.0" has unmet peer dependency "@babel/core@^7.17.9".
```

2. 
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— 
- Search for "start command prompt with ruby" in the start menu and right click on it. Select "More" then "Run as administrator". This will open an elevated command prompt with Ruby loaded.
- â†’Navigate to your project directory(`cd xxx\xxx\xxx-project-directory`) and run: `bundle update`
- â†’Run `./bin/bundle install` in git bash
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— no permission from administrator 
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— after `bundle add shakapacker --strict`, `./bin/bundle install` in git bash:        
```javascript
Installing shakapacker 7.1.0        
--- ERROR REPORT TEMPLATE -------------------------------------------------------

Errno::EACCES: Permission denied @ rb_file_s_symlink 
```

1. 
ğ™¨ğ™¤ğ™¡ğ™ªğ™©ğ™ğ™¤ğ™£:  
â— change a better WI-FI
ğ™§ğ™šğ™–ğ™¨ğ™¤ğ™£:  
â— low speed of network
ğ™šğ™§ğ™§ğ™¤ğ™§ 
â— stuck at "run bundle install"

---
ref:
- [How to Create a CRUD App with Rails and React Â· James Hibbard](https://hibbard.eu/rails-react-crud-app/#creating-a-hello-world-react-app)
- [Alpha preview: Using React with importmaps on Rails 7 - YouTube](https://www.youtube.com/watch?v=k73LKxim6tw)
- [GitHub - rails/importmap-rails: Use ESM with importmap to manage modern JavaScript in Rails without transpiling or bundling.](https://github.com/rails/importmap-rails)
- https://github.com/shakacode/shakapacker#installation
- https://github.com/shakacode/shakapacker/blob/master/docs/v7_upgrade.md
- https://github.com/shakacode/shakapacker/blob/master/docs/troubleshooting.md